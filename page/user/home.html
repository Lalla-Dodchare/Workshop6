<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Home</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- แถบด้านบน -->
    <div class="flex justify-between items-center bg-white p-4 shadow">
        <h1 class="text-xl font-bold">File Manager</h1>
        <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition cursor-pointer">
            Logout
        </button>
    </div>

    <!-- เนื้อหาหลัก (ส่วน upload + ตารางไฟล์ จะเพิ่มตรงนี้) -->
    <div class="max-w-4xl mx-auto p-6">
            <!-- ส่วน Upload -->
    <div class="bg-white p-6 rounded-2xl shadow mb-6">
        <h2 class="text-lg font-bold mb-4">Upload File</h2>
        <input type="file" id="fileInput" class="mb-4">
        <img id="preview" class="max-w-xs mb-4 hidden">
        <br>
        <button id="uploadBtn" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition cursor-pointer">
            Upload
        </button>
    </div>
    <!-- ตารางรายการไฟล์ -->
    <div class="bg-white p-6 rounded-2xl shadow">
        <h2 class="text-lg font-bold mb-4">My Files</h2>
        <table class="w-full">
            <thead>
                <tr class="border-b">
                    <th class="text-left p-2">ชื่อไฟล์</th>
                    <th class="text-left p-2">Download</th>
                    <th class="text-left p-2">ลบ</th>
                </tr>
            </thead>
        <tbody id="fileList">
            <!-- JS จะเพิ่มแถวไฟล์ตรงนี้ทีหลัง -->
        </tbody>
    </table>
    </div>

    </div>
    <script>
        function logout() {
            localStorage.removeItem('token');
            window.location.href = '/index.html';
        }
        // --- เช็ค token ---
    const token = localStorage.getItem('token');
    if (!token) {
    window.location.href = '/index.html';
    }

    function loadFiles(){
        fetch('/files',{
            headers: { 'Authorization': 'Bearer ' + token}
        })
        .then(res => res.json())
        .then(files =>{
            const fileList =document.getElementById('fileList');
            fileList.innerHTML = '';
            files.forEach(file =>{
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="p-2">${file}</td>
                    <td class="p-2">
                        <button onclick="download('${file}')">Download</button>
                    </td>
                    <td class="p-2">
                        <button onclick="deleteFile('${file}')">ลบ</button>
                    </td>
                `;
                fileList.appendChild(tr);
            })

        })
    }
    loadFiles();

        document.getElementById('uploadBtn').addEventListener('click',() =>{
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0]
            if (!file) return alert('ไปเลือกไฟล์ก่อน');
            const formData = new FormData();
            formData.append('file',file);
            fetch('/upload',{
                method: 'POST',
                headers: { 'Authorization': 'Bearer ' + token},
                body: formData
            })
            .then(res => res.json())
            .then(data =>{
                alert(data.message);
                loadFiles();
            })
        })

    </script>
</body>
</html>
